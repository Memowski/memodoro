<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title id="doc-title">YKS Zamanlayƒ±cƒ±sƒ±</title>
    
    <style>
        /* Yeni: Sayfa Ge√ßi≈ü Animasyonu CSS'i */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Genel Font ve Merkezleme */
        body {
            font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif; 
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh; 
            width: 100vw; 
            margin: 0;
            color: #ffffff; 
            transition: background-image 0.5s ease-in-out, background-color 0.5s; 
            overflow: hidden; 
            
            /* Ba≈ülangƒ±√ß Statik Arkaplan Ayarlarƒ± */
            background-image: url('assets/focus-bg.jpg'); 
            background-size: cover; 
            background-attachment: fixed;
            background-repeat: no-repeat;
            background-position: center center;
            background-blend-mode: overlay;
            background-color: rgba(0, 0, 0, 0.3);
            
            animation: fadeIn 0.8s ease-out; 
        }

        /* Vƒ∞DEO ARKA PLAN STƒ∞Lƒ∞ */
        #background-video {
            position: fixed;
            right: 0;
            bottom: 0;
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            z-index: -101; 
            object-fit: cover; 
            transition: opacity 0.5s;
        }

        .container {
            background-color: transparent; 
            padding: 50px;
            border-radius: 10px;
            text-align: center;
            max-width: 500px; 
            width: 100%;
            padding-bottom: 20px; 
        }

        /* --- BA≈ûLIK VE S√ñZLER --- */
        .header-top {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            pointer-events: none; 
        }
        
        #app-logo {
            font-size: 1.5em;
            font-weight: 700;
            color: #ffffff;
            letter-spacing: 2px;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
            pointer-events: all;
        }

        #quote {
            font-size: 1.1em;
            font-weight: 400;
            color: #ffffff;
            text-align: right;
            line-height: 1.4;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
            pointer-events: all;
        }

        /* D√ºzenlenebilir Ba≈ülƒ±k Stili */
        #main-title {
            font-size: 1.5em;
            margin-bottom: 5px;
            color: #ffffff;
            font-weight: 400;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
            cursor: pointer; 
        }
        
        /* --- ZAMANLAYICI MODLARI --- */
        .modes {
            margin-bottom: 40px;
            display: flex;
            justify-content: center;
        }
        .modes button {
            background-color: rgba(255, 255, 255, 0.2);
            border: none;
            color: #ffffff;
            padding: 8px 15px;
            margin: 0 4px;
            border-radius: 20px; 
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 500;
            transition: background-color 0.2s, color 0.2s;
            backdrop-filter: blur(5px);
        }

        .modes button.active {
            background-color: rgba(255, 255, 255, 0.4); 
            color: white;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.3); 
        }

        /* --- ZAMANLAYICI EKRANI --- */
        .timer {
            font-size: 9em; 
            font-weight: 700; 
            margin: 0;
            letter-spacing: 2px;
            color: #ffffff;
            text-shadow: 0 4px 6px rgba(0, 0, 0, 0.5);
        }

        /* --- MERKEZƒ∞ KONTROL ALANI (SAYA√á ALTI) --- */
        .timer-controls {
            margin-top: 40px; /* Saya√ß ile butonlar arasƒ± bo≈üluk */
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px; 
        }

        /* Ana Buton Stilleri (Ba≈ülat/Durdur) */
        #start-btn, #pause-btn {
            background-color: rgba(255, 255, 255, 0.25); 
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 30px; 
            cursor: pointer;
            font-size: 1.3em;
            font-weight: 600;
            transition: background-color 0.2s;
            min-width: 150px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(5px);
            pointer-events: all;
        }

        #pause-btn {
             background-color: #e43f5a; 
        }
        
        /* Sƒ±fƒ±rla Butonu (Yenile Simgesi) */
        #reset-btn {
            background: none;
            color: #ffffff;
            border: none;
            cursor: pointer;
            font-size: 2.2em; 
            padding: 5px;
            transition: color 0.2s, transform 0.2s;
            margin: 0; 
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
            pointer-events: all;
        }
        
        /* --- SAƒû ALT K√ñ≈ûE ƒ∞KON KONTROLLERƒ∞ --- */
        .bottom-right-icons-container {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
            z-index: 100;
            pointer-events: all;
        }
        
        /* ƒ∞kon Butonlarƒ± Stilleri */
        .bottom-right-icons-container button, .bottom-right-icons-container a {
            background: none;
            border: none;
            color: #ffffff;
            cursor: pointer;
            font-size: 1.8em;
            opacity: 0.7;
            transition: opacity 0.2s;
            padding: 0;
            line-height: 1;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
            text-decoration: none;
        }
        
        /* Ayarlar Paneli ve M√ºzik Paneli konumu */
        #settings-panel {
            position: absolute;
            bottom: 60px; /* ƒ∞kon grubunun yukarƒ±sƒ±nda */
            right: 20px;
            width: 300px; 
            background: rgba(30, 30, 30, 0.9); 
            border: 1px solid rgba(255, 255, 255, 0.3); 
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            z-index: 99;
            display: none; 
            text-align: left; 
        }
        #music-panel {
            position: absolute;
            bottom: 60px; 
            right: 80px; 
            width: 300px; 
            background: rgba(30, 30, 30, 0.95); 
            border: 1px solid rgba(255, 255, 255, 0.3); 
            border-radius: 10px;
            padding: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            z-index: 99;
            display: none; 
            text-align: left; 
        }

        /* --- ARKA PLAN √ñNƒ∞ZLEME STƒ∞Lƒ∞ --- */
        .bg-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap; 
            justify-content: flex-start;
        }
        .bg-options button {
            width: 60px; height: 60px; min-width: 60px; min-height: 60px;
            padding: 0; border: 3px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px; background-size: cover; background-position: center;
            cursor: pointer; transition: border-color 0.2s, transform 0.1s;
            font-size: 0; line-height: 0; position: relative;
        }
        .bg-options button.selected { border-color: #1ed760; transform: scale(1.05); }
        
        /* Sadece siyah arka plan i√ßin */
        .bg-options button.black-thumb {
            background-color: #000000;
        }


        /* ================================================= */
        /* MOBƒ∞L OPTƒ∞Mƒ∞ZASYON (MEDIA QUERY)         */
        /* ================================================= */

        @media (max-width: 600px) {
            
            body {
                overflow-y: auto; 
            }

            .container {
                padding: 20px;
                max-width: 95%;
                margin-top: 10vh; 
            }
            
            .timer {
                font-size: 6em; 
            }
            
            /* Ana Butonlar Mobil Stil */
            #start-btn, #pause-btn {
                padding: 12px 25px;
                font-size: 1.1em;
                min-width: 120px;
            }
            #reset-btn {
                font-size: 1.8em;
            }

            /* ƒ∞kon Kontrolleri Mobil Konumlandƒ±rma */
            .bottom-right-icons-container {
                bottom: 10px;
                right: 10px;
                gap: 10px;
            }
            .bottom-right-icons-container button, .bottom-right-icons-container a {
                font-size: 1.5em; 
            }

            /* Ayarlar ve M√ºzik Panelleri Mobil Konumlandƒ±rma */
            #settings-panel, #music-panel {
                width: 90%; 
                left: 50%;
                transform: translateX(-50%);
                bottom: 50px; /* ƒ∞konlarƒ±n yukarƒ±sƒ±nda kalmasƒ± i√ßin */
                right: auto;
                max-height: 80vh; 
                overflow-y: auto; 
            }
        } /* End of media query */

    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
</head>
<body>
    
    <video autoplay muted loop id="background-video" style="display:none;">
        <source src="assets/lofi_v1.mp4" type="video/mp4" id="video-source">
        Tarayƒ±cƒ±nƒ±z video etiketini desteklemiyor.
    </video>

    <div class="header-top">
        <div id="app-logo">memodoro<span style="font-size:0.5em; font-weight: 400; display: block; letter-spacing: 0;">by Mehmet √ñzalp</span></div>
        <div id="quote">"Sometimes you win, <br> sometimes you learn"</div>
    </div>
    
    <div class="bottom-right-icons-container">
        <button id="sound-toggle-btn" title="Zil Sesini Kapat">üîî</button>
        <a id="download-btn" href="download.html" title="Uygulamayƒ± ƒ∞ndir">‚¨áÔ∏è</a>
        <button id="music-btn" title="Spotify M√ºzik">üéµ</button>
        <button id="fullscreen-btn" title="Tam Ekran Yap">‚õ∂</button>
        <button id="menu-btn" title="Ayarlar">‚öôÔ∏è</button>
    </div>

    <div id="music-panel">
        <div id="music-header">
            <span id="music-title">Spotify M√ºzik Kontrol</span>
            <button id="close-music-btn">‚úñ</button>
        </div>
        
        <div id="spotify-control-area" style="padding: 5px 0 0;">
            <div id="spotify-status" style="margin-bottom: 10px; font-size: 0.9em; text-align: center;">Spotify ile baƒülantƒ± yok.</div>
            <button id="spotify-login-btn">Spotify ile Giri≈ü Yap</button>
            
            <div id="playlist-selector" style="margin-top: 15px; display:none;">
                <label style="display: block; margin-bottom: 5px; font-size: 0.9em; color: #ccc;">√áalma Listesi Se√ß:</label>
                <select id="playlist-select">
                    <option value="">Y√ºkleniyor...</option>
                </select>
                <button id="play-selected-btn">Oynat</button>
            </div>
        </div>
    </div>

    <div id="settings-panel">
        <h3><span id="settings-title">Ayarlar</span></h3>
        
        <div class="setting-group">
            <label id="lang-label">Dil Se√ßimi</label>
            <div class="lang-options">
                <button id="lang-tr-btn" onclick="setLanguage('tr')" class="selected">T√ºrk√ße</button>
                <button id="lang-en-btn" onclick="setLanguage('en')">English</button>
            </div>
        </div>
        
        <div class="setting-group">
            <label>S√ºre Ayarlarƒ± (Dakika)</label>
            <div style="display: flex; flex-direction: column;">
                 <div class="time-setting-item">
                     <label>√áalƒ±≈üma S√ºresi:</label>
                     <input type="number" id="pomodoro-input" class="time-input" placeholder="25" value="25" min="1">
                 </div>
                 <div class="time-setting-item">
                     <label>Kƒ±sa Mola S√ºresi:</label>
                     <input type="number" id="short-break-input" class="time-input" placeholder="5" value="5" min="1">
                 </div>
                 <div class="time-setting-item">
                     <label>Uzun Mola S√ºresi:</label>
                     <input type="number" id="long-break-input" class="time-input" placeholder="15" value="15" min="1">
                 </div>
                 <button onclick="applyNewDurations()" style="margin-top: 10px; background: #6841b8; color: white; border: none; padding: 8px; border-radius: 5px; cursor: pointer;">Uygula</button>
            </div>
        </div>
        
        <div class="setting-group">
            <label id="bg-label">Arka Plan Se√ßimi</label>
            <div class="bg-options" id="bg-options-container">
                </div>
        </div>
    </div>

    <div class="container">
        <h1 id="main-title" contenteditable="true">YKS ZAMANI</h1> 
        
        <div class="modes">
            <button id="pomodoro-btn" data-key="pomodoro_mode" class="active">√áalƒ±≈üma</button>
            <button id="short-break-btn" data-key="short_break_mode">Kƒ±sa Mola</button>
            <button id="long-break-btn" data-key="long_break_mode">Uzun Mola</button>
        </div>
        
        <div id="timer" class="timer">25:00</div>
        
        <div class="timer-controls">
            <button id="start-btn" data-key="start_btn">BA≈ûLAT</button>
            <button id="reset-btn" data-key="reset_btn">‚Üª</button> 
        </div>
        
    </div>
    
    <script>
        // --- Dƒ∞L S√ñZL√úƒû√ú VE G√ñRSEL VERƒ∞LERƒ∞ ---
        const TRANSLATIONS = {
            'tr': {
                'doc_title': 'YKS Zamanlayƒ±cƒ±sƒ±', 
                'main_title': 'YKS ZAMANI', 
                'settings_title': 'Ayarlar',
                'lang_label': 'Dil Se√ßimi',
                'bg_label': 'Arka Plan Se√ßimi',
                'pomodoro_mode': '√áalƒ±≈üma',
                'short_break_mode': 'Kƒ±sa Mola',
                'long_break_mode': 'Uzun Mola',
                'start_btn': 'BA≈ûLAT',
                'pause_btn': 'DURDUR',
                'reset_btn': 'SIFIRLA', 
                'continue_btn': 'DEVAM ET',
                'alert_message': 'S√ºre bitti! Yeni moda ge√ßiliyor.',
                'bg_focus': 'Odak Yolu',
                'bg_lofi_v1': 'Lofi Hip-Hop', 
                'bg_rain': 'Yaƒümur',
                'bg_forest': 'Orman',
                'bg_black': 'Siyah'
            },
            'en': {
                'doc_title': 'YKS Timer',
                'main_title': 'YKS TIME',
                'settings_title': 'Settings',
                'lang_label': 'Language Selection',
                'bg_label': 'Background Selection',
                'pomodoro_mode': 'Study', 
                'short_break_mode': 'Short Break',
                'long_break_mode': 'Long Break',
                'start_btn': 'START',
                'pause_btn': 'PAUSE',
                'reset_btn': 'RESET',
                'continue_btn': 'RESUME',
                'alert_message': 'Time\'s up! Switching mode.',
                'bg_focus': 'Focus Path',
                'bg_lofi_v1': 'Lofi Hip-Hop', 
                'bg_rain': 'Rain',
                'bg_forest': 'Forest',
                'bg_black': 'Black'
            }
        };

        const BACKGROUND_OPTIONS = [
            // G√úNCELLEME YAPILDI: Video i√ßin √∂nizleme dosyasƒ± 'assets/dappy.jpg' olarak deƒüi≈ütirildi.
            { nameKey: 'bg_lofi_v1', file: 'assets/lofi_v1.mp4', type: 'video', thumbClass: 'video-thumb', thumbFile: 'assets/dappy.jpg'}, 
            { nameKey: 'bg_focus', file: 'assets/focus-bg.jpg', type: 'image', thumbClass: '', thumbFile: 'assets/focus-bg.jpg'},
            { nameKey: 'bg_rain', file: 'assets/rain.jpg', type: 'image', thumbClass: '', thumbFile: 'assets/rain.jpg'},
            { nameKey: 'bg_forest', file: 'assets/forest.jpg', type: 'image', thumbClass: '', thumbFile: 'assets/forest.jpg'},
            { nameKey: 'bg_black', file: 'pure-black', type: 'color', thumbClass: 'black-thumb', thumbFile: ''}
        ];

        // --- DOM Elementleri ve Deƒüi≈üken Tanƒ±mlamalarƒ± ---
        const timerDisplay = document.getElementById('timer');
        const startBtn = document.getElementById('start-btn');
        const pauseBtn = document.createElement('button'); 
        pauseBtn.id = 'pause-btn';
        pauseBtn.setAttribute('data-key', 'pause_btn');
        const resetBtn = document.getElementById('reset-btn');
        const pomodoroBtn = document.getElementById('pomodoro-btn');
        const shortBreakBtn = document.getElementById('short-break-btn');
        const longBreakBtn = document.getElementById('long-break-btn'); 
        const mainTitle = document.getElementById('main-title'); 
        const menuBtn = document.getElementById('menu-btn');
        const settingsPanel = document.getElementById('settings-panel');
        const bgOptionsContainer = document.getElementById('bg-options-container');
        const fullscreenBtn = document.getElementById('fullscreen-btn');
        const musicBtn = document.getElementById('music-btn');
        const musicPanel = document.getElementById('music-panel');
        const closeMusicBtn = document.getElementById('close-music-btn');
        const soundToggleBtn = document.getElementById('sound-toggle-btn'); 
        const spotifyLoginBtn = document.getElementById('spotify-login-btn');
        const spotifyStatus = document.getElementById('spotify-status');
        const playlistSelector = document.getElementById('playlist-selector');
        const playlistSelect = document.getElementById('playlist-select');
        const playSelectedBtn = document.getElementById('play-selected-btn');
        const pomodoroInput = document.getElementById('pomodoro-input');
        const shortBreakInput = document.getElementById('short-break-input');
        const longBreakInput = document.getElementById('long-break-input');
        const videoElement = document.getElementById('background-video'); 
        const videoSource = document.getElementById('video-source'); 
        const timerControlsDiv = document.querySelector('.timer-controls'); // Yeni kontrol grubu

        
        let POMODORO_DURATION = 25 * 60;
        let SHORT_BREAK_DURATION = 5 * 60; 
        let LONG_BREAK_DURATION = 15 * 60; 
        let currentLanguage = 'tr'; 
        let currentDuration = POMODORO_DURATION;
        let isRunning = false;
        let interval;
        let timeRemaining = currentDuration;
        let isSoundOn = true; 
        const dingSound = new Audio('assets/ding.mp3'); 
        let spotifyAccessToken = null; 
        let currentPlaylistUri = null; 
        
        // --- SPOTIFY FONKSƒ∞YONLARI (Deƒüi≈ümedi) ---
        function updateSpotifyUI(loggedIn, message = "") {
            if (loggedIn) {
                spotifyLoginBtn.style.display = 'none';
                playlistSelector.style.display = 'block';
                spotifyStatus.textContent = 'Spotify Baƒülandƒ±';
            } else {
                spotifyLoginBtn.style.display = 'block';
                playlistSelector.style.display = 'none';
                spotifyStatus.textContent = message || 'Spotify ile baƒülantƒ± yok.';
            }
        }

        async function fetchPlaylists(token) {
            spotifyStatus.textContent = "√áalma listeleri y√ºkleniyor...";
            try {
                // Bu URL Spotify API'si deƒüil, √∂rnek bir API yanƒ±tƒ±dƒ±r
                const response = await fetch('https://api.spotify.com/v1/me/playlists?limit=5', {
                    headers: {
                        'Authorization': 'Bearer ' + token
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    renderPlaylists(data.items);
                    updateSpotifyUI(true);
                } else if (response.status === 401) { 
                    updateSpotifyUI(false, "Oturum s√ºreniz doldu. L√ºtfen tekrar giri≈ü yapƒ±n.");
                    localStorage.removeItem('spotify_access_token');
                    spotifyAccessToken = null;
                } else {
                    throw new Error('API yanƒ±tƒ± ba≈üarƒ±sƒ±z oldu: ' + response.status);
                }
            } catch (error) {
                updateSpotifyUI(false, "√áalma listesi y√ºklenirken hata olu≈ütu.");
                console.error("√áalma listesi √ßekme hatasƒ±:", error);
            }
        }

        function renderPlaylists(playlists) {
            playlistSelect.innerHTML = '<option value="">√áalma Listesi Se√ß</option>';
            playlists.forEach(playlist => {
                const option = document.createElement('option');
                option.value = playlist.uri;
                option.textContent = playlist.name;
                playlistSelect.appendChild(option);
            });
        }

        function playPlaylist() {
            const selectedUri = playlistSelect.value;
            if (selectedUri) {
                currentPlaylistUri = selectedUri;
                alert(`√áalma listesi oynatƒ±lacak: ${currentPlaylistUri}\n(Spotify SDK entegrasyonu gerekli)`);
            } else {
                alert("L√ºtfen bir √ßalma listesi se√ßin.");
            }
        }

        function checkSpotifyToken() {
            const urlParams = new URLSearchParams(window.location.search);
            const tokenFromUrl = urlParams.get('spotify_token');
            const error = urlParams.get('error');

            if (tokenFromUrl) {
                localStorage.setItem('spotify_access_token', tokenFromUrl);
                window.history.replaceState({}, document.title, window.location.pathname); 
                spotifyAccessToken = tokenFromUrl;
                fetchPlaylists(spotifyAccessToken); 

            } else if (localStorage.getItem('spotify_access_token')) {
                spotifyAccessToken = localStorage.getItem('spotify_access_token');
                fetchPlaylists(spotifyAccessToken); 

            } else if (error) {
                updateSpotifyUI(false, "Spotify baƒülantƒ±sƒ± ba≈üarƒ±sƒ±z oldu.");
            } else {
                updateSpotifyUI(false);
            }
        }
        
        // --- S√úRE AYARLAMA ƒ∞≈ûLEVƒ∞ (Deƒüi≈ümedi) ---
        function applyNewDurations() {
            const newPomodoro = Math.max(1, parseInt(pomodoroInput.value) || 25);
            const newShort = Math.max(1, parseInt(shortBreakInput.value) || 5);
            const newLong = Math.max(1, parseInt(longBreakInput.value) || 15);
            
            pomodoroInput.value = newPomodoro;
            shortBreakInput.value = newShort;
            longBreakInput.value = newLong;

            POMODORO_DURATION = newPomodoro * 60;
            SHORT_BREAK_DURATION = newShort * 60;
            LONG_BREAK_DURATION = newLong * 60;

            if (!isRunning) {
                if (pomodoroBtn.classList.contains('active')) {
                    currentDuration = POMODORO_DURATION;
                } else if (shortBreakBtn.classList.contains('active')) {
                    currentDuration = SHORT_BREAK_DURATION;
                } else if (longBreakBtn.classList.contains('active')) {
                    currentDuration = LONG_BREAK_DURATION;
                }
                timeRemaining = currentDuration;
                updateTimerDisplay();
            }
            alert('Yeni s√ºreler ba≈üarƒ±yla uygulandƒ±!');
        }

        // --- Dƒ∞L VE √áEVƒ∞Rƒ∞ ƒ∞≈ûLEVLERƒ∞ (Deƒüi≈ümedi) ---
        function translateUI(lang) {
            const texts = TRANSLATIONS[lang];
            
            document.getElementById('doc-title').textContent = texts.doc_title;
            
            if (mainTitle.getAttribute('data-initial') === 'true') {
                 mainTitle.textContent = texts.main_title;
                 mainTitle.removeAttribute('data-initial');
            } else if (currentLanguage !== lang) {
                 const currentDefault = currentLanguage === 'tr' ? 'YKS ZAMANI' : 'YKS TIME';
                 if (mainTitle.textContent.trim() === currentDefault) {
                     mainTitle.textContent = texts.main_title;
                 }
            }
            
            document.getElementById('settings-title').textContent = texts.settings_title;
            document.getElementById('lang-label').textContent = texts.lang_label;
            document.getElementById('bg-label').textContent = texts.bg_label;

            document.querySelectorAll('[data-key]').forEach(btn => {
                const key = btn.getAttribute('data-key');
                if (key !== 'reset_btn' && key !== 'pause_btn') {
                     btn.textContent = texts[key];
                }
            });
            
            if (isRunning) {
                 pauseBtn.textContent = texts.pause_btn;
            } else if (startBtn.parentElement && startBtn.textContent !== texts.start_btn) {
                 startBtn.textContent = texts.continue_btn;
            } else {
                 startBtn.textContent = texts.start_btn;
            }
            
            document.getElementById('lang-tr-btn').classList.remove('selected');
            document.getElementById('lang-en-btn').classList.remove('selected');
            document.getElementById(`lang-${lang}-btn`).classList.add('selected');

            currentLanguage = lang;
        }
        
        // --- ZAMANLAYICI ƒ∞≈ûLEVLERƒ∞ (Deƒüi≈ümedi) ---
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            const paddedMinutes = String(minutes).padStart(2, '0');
            const paddedSeconds = String(remainingSeconds).padStart(2, '0');
            return `${paddedMinutes}:${paddedSeconds}`;
        }
        function updateTimerDisplay() { 
            timerDisplay.textContent = formatTime(timeRemaining);
        }
        function startTimer() { 
            if (isRunning) return; 

            isRunning = true;
            
            // Butonlarƒ± deƒüi≈ütirmek i√ßin yeni ebeveyni kullan
            if (!pauseBtn.parentElement) {
                 timerControlsDiv.replaceChild(pauseBtn, startBtn); 
            }
            pauseBtn.textContent = TRANSLATIONS[currentLanguage].pause_btn;

            interval = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                if (timeRemaining <= 0) {
                    clearInterval(interval);
                    isRunning = false;
                    
                    if (isSoundOn) {
                        dingSound.play();
                        dingSound.currentTime = 0;
                    }
                    
                    if (currentDuration === POMODORO_DURATION) {
                        switchMode(SHORT_BREAK_DURATION, shortBreakBtn);
                        startTimer();
                    } else if (currentDuration === SHORT_BREAK_DURATION) {
                        switchMode(POMODORO_DURATION, pomodoroBtn); 
                    } else if (currentDuration === LONG_BREAK_DURATION) {
                         switchMode(POMODORO_DURATION, pomodoroBtn);
                    }
                    alert(TRANSLATIONS[currentLanguage].alert_message);
                }
            }, 1000);
        }
        function pauseTimer() { 
            if (!isRunning) return;
            isRunning = false;
            clearInterval(interval);
            
            // Butonlarƒ± deƒüi≈ütirmek i√ßin yeni ebeveyni kullan
            if(pauseBtn.parentElement) {
                timerControlsDiv.replaceChild(startBtn, pauseBtn); 
            }
            startBtn.textContent = TRANSLATIONS[currentLanguage].continue_btn;
        }
        function resetTimer() { 
            pauseTimer(); 
            // Butonlarƒ± deƒüi≈ütirmek i√ßin yeni ebeveyni kullan
            if(pauseBtn.parentElement) {
                timerControlsDiv.replaceChild(startBtn, pauseBtn); 
            }
            startBtn.textContent = TRANSLATIONS[currentLanguage].start_btn;
            
            if(pomodoroBtn.classList.contains('active')) {
                currentDuration = POMODORO_DURATION;
            } else if (shortBreakBtn.classList.contains('active')) {
                 currentDuration = SHORT_BREAK_DURATION;
            } else if (longBreakBtn.classList.contains('active')) {
                 currentDuration = LONG_BREAK_DURATION;
            }

            timeRemaining = currentDuration;
            updateTimerDisplay();
        }
        function switchMode(duration, btn) { 
            resetTimer(); 
            document.querySelector('.modes button.active').classList.remove('active');
            btn.classList.add('active');
            currentDuration = duration;
            timeRemaining = currentDuration;
            
            startBtn.textContent = TRANSLATIONS[currentLanguage].start_btn;
            updateTimerDisplay();
        }
        
        // --- Dƒ∞ƒûER ƒ∞≈ûLEVLER VE ARKA PLAN KONTROL√ú (Deƒüi≈ümedi) ---
        
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    console.error("Tam ekran etkinle≈ütirilemiyor:", err);
                });
            } else {
                document.exitFullscreen();
            }
        }
        
        function changeBackground(optionFile, optionType, buttonElement) {
            const body = document.body;
            
            if (optionType === 'video') {
                body.style.backgroundImage = 'none';
                body.style.backgroundColor = 'rgba(0, 0, 0, 0.3)';
                body.style.backgroundBlendMode = 'overlay';
                
                videoElement.style.display = 'block';
                videoSource.src = optionFile;
                videoElement.load();
                videoElement.play().catch(error => {
                    console.error("Video oynatƒ±lƒ±rken otomatik oynatma hatasƒ±:", error);
                });

            } else {
                videoElement.style.display = 'none';

                if (optionFile === 'pure-black') {
                    body.style.backgroundImage = 'none';
                    body.style.backgroundColor = '#000000';
                    body.style.backgroundBlendMode = 'none';
                } else {
                    body.style.backgroundImage = `url('${optionFile}')`;
                    body.style.backgroundColor = 'rgba(0, 0, 0, 0.3)';
                    body.style.backgroundBlendMode = 'overlay';
                }
            }

            document.querySelectorAll('.bg-options button').forEach(btn => btn.classList.remove('selected'));
            if (buttonElement) {
                 buttonElement.classList.add('selected');
            }
        }

        function renderBackgroundOptions() {
            bgOptionsContainer.innerHTML = '';
            
            // Se√ßili arka planƒ± belirlemek i√ßin bir kontrol mekanizmasƒ±
            const isVideoActive = videoElement.style.display === 'block';
            const isBlackActive = !isVideoActive && document.body.style.backgroundImage.includes('none') && document.body.style.backgroundColor === 'rgb(0, 0, 0)';

            BACKGROUND_OPTIONS.forEach(option => {
                const button = document.createElement('button');
                button.textContent = TRANSLATIONS[currentLanguage][option.nameKey]; 
                
                if (option.thumbFile) {
                    // Video se√ßeneƒüi i√ßin artƒ±k 'assets/dappy.jpg' kullanƒ±lacak
                    button.style.backgroundImage = `url('${option.thumbFile}')`;
                }
                if (option.thumbClass) {
                    button.classList.add(option.thumbClass);
                }
                
                button.onclick = () => changeBackground(option.file, option.type, button);
                
                let isSelected = false;
                if (option.type === 'video' && isVideoActive) {
                    isSelected = true;
                } else if (option.type === 'color' && isBlackActive) {
                    isSelected = true;
                } else if (option.type === 'image' && document.body.style.backgroundImage.includes(option.file)) {
                    isSelected = true;
                }
                
                if (isSelected) {
                     button.classList.add('selected');
                }
                
                bgOptionsContainer.appendChild(button);
            });
        }


        // --- Olay Dinleyicileri (Deƒüi≈ümedi) ---
        
        fullscreenBtn.addEventListener('click', toggleFullscreen);

        menuBtn.addEventListener('click', () => {
            musicPanel.style.display = 'none';

            if (settingsPanel.style.display === 'block') {
                settingsPanel.style.display = 'none';
            } else {
                pomodoroInput.value = POMODORO_DURATION / 60;
                shortBreakInput.value = SHORT_BREAK_DURATION / 60;
                longBreakInput.value = LONG_BREAK_DURATION / 60;
                
                renderBackgroundOptions(); 
                settingsPanel.style.display = 'block';
            }
        });
        
        musicBtn.addEventListener('click', () => {
            settingsPanel.style.display = 'none';

            if (musicPanel.style.display === 'block') {
                musicPanel.style.display = 'none';
            } else {
                musicPanel.style.display = 'block';
            }
        });
        
        closeMusicBtn.addEventListener('click', () => {
            musicPanel.style.display = 'none';
        });

        startBtn.addEventListener('click', startTimer);
        pauseBtn.addEventListener('click', pauseTimer);
        resetBtn.addEventListener('click', resetTimer);

        pomodoroBtn.addEventListener('click', () => { switchMode(POMODORO_DURATION, pomodoroBtn); });
        shortBreakBtn.addEventListener('click', () => { switchMode(SHORT_BREAK_DURATION, shortBreakBtn); });
        longBreakBtn.addEventListener('click', () => { switchMode(LONG_BREAK_DURATION, longBreakBtn); });
        
        soundToggleBtn.addEventListener('click', () => {
            isSoundOn = !isSoundOn;
            
            if (isSoundOn) {
                soundToggleBtn.textContent = 'üîî';
                soundToggleBtn.classList.remove('sound-off');
                soundToggleBtn.title = 'Zil Sesini Kapat';
            } else {
                soundToggleBtn.textContent = 'üîï';
                soundToggleBtn.classList.add('sound-off');
                soundToggleBtn.title = 'Zil Sesini A√ß';
            }
        });
        
        spotifyLoginBtn.addEventListener('click', () => {
            window.location.href = '/api/login';
        });

        playSelectedBtn.addEventListener('click', playPlaylist);


        mainTitle.addEventListener('blur', () => {
            if (mainTitle.textContent.trim() === '') {
                mainTitle.textContent = 'YKS ZAMANI';
            }
        });


        window.setLanguage = translateUI;
        window.applyNewDurations = applyNewDurations;
        window.changeBackground = changeBackground;


        // Ba≈ülangƒ±√ß ayarlarƒ±
        mainTitle.setAttribute('data-initial', 'true');
        translateUI('tr');
        updateTimerDisplay();
        
        // Ba≈ülangƒ±√ßta lofi_v1.mp4'√º ayarla (ilk se√ßenek)
        changeBackground(BACKGROUND_OPTIONS[0].file, BACKGROUND_OPTIONS[0].type, null); 
        checkSpotifyToken(); 
    </script>
</body>
</html>
